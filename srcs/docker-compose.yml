services:
  mariadb:
    image: mariadb
    build:
      context: ./requirements/mariadb
    volumes:
      - ./requirements/mariadb/conf/config.conf:/etc/my.cnf
      - mariadb:/var/lib/mysql
    networks:
      - inception
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD:?required}
      - MYSQL_USER=${MYSQL_USER:?required}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD:?required}
      - MYSQL_DATABASE=${MYSQL_DATABASE:?required}
  wordpress:
    image: wordpress
    build:
      context: ./requirements/wordpress
    depends_on:
      - mariadb
    volumes:
      - wordpress:/var/www/html
      - ./requirements/wordpress/conf/config.conf:/etc/php/php-fpm.d/www.conf:ro
    networks:
      - inception
    restart: always
    environment:
      - WORDPRESS_DB_HOST=mariadb
      - WORDPRESS_DB_USER=${MYSQL_USER:?required}
      - WORDPRESS_DB_PASSWORD=${MYSQL_PASSWORD:?required}
      - WORDPRESS_DB_NAME=${MYSQL_DATABASE:?required}
      - WORDPRESS_URL=${DOMAIN_NAME:?required}
      - WORDPRESS_SITE_TITLE=${WORDPRESS_SITE_TITLE:?required}
      - WORDPRESS_ADMIN=${WORDPRESS_ADMIN:?required}
      - WORDPRESS_ADMIN_EMAIL=${WORDPRESS_ADMIN_EMAIL:?required}
      - WORDPRESS_ADMIN_PASSWORD=${WORDPRESS_ADMIN_PASSWORD:?required}
      - WORDPRESS_EDITOR=${WORDPRESS_EDITOR:?required}
      - WORDPRESS_EDITOR_EMAIL=${WORDPRESS_EDITOR_EMAIL:?required}
      - WORDPRESS_EDITOR_PASSWORD=${WORDPRESS_EDITOR_PASSWORD:?required}
  nginx:
    image: nginx:1.24.0-alpine3.17
    depends_on:
      - wordpress
    volumes:
      - wordpress:/var/www/html:ro
      - ./requirements/nginx/conf/config.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - inception
    ports:
      - 80:80
    restart: always
volumes:
  mariadb:
    driver: local
    name: mariadb
    driver_opts:
      type: 'none'
      o: 'bind'
      device: "/home/$USER/data/mariadb"
  wordpress:
    driver: local
    name: wordpress
    driver_opts:
      type: 'none'
      o: 'bind'
      device: "/home/$USER/data/wordpress"
networks:
  inception:
    name: inception
